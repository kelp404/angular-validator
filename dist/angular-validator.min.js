(function(){var a,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=angular.element,angular.module("validator.directive",["validator.provider"]).directive("validator",["$injector",function(c){return{restrict:"A",require:"ngModel",link:function(d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s;return i=c.get("$validator"),h=c.get("$parse"),m=h(f.ngModel),q=[],k=[],j={},r=function(a,c){var d;if(null==c&&(c={}),c.group){if(d=c.group,b.call(k,d)>=0)return q=j[c.group],void s(q,a,c);if(f.validatorGroup===c.group)return void s(q,a,c)}return s(q,a,c)},s=function(a,b,h){var i,j,k,l,n,o,p;if(l=0,i=0,j=function(){var b,i,j;if(++l>=a.length){for(g.$setValidity(f.ngModel,!0),i=0,j=a.length;j>i;i++)b=a[i],b.success(m(d),d,e,f,c);"function"==typeof h.success&&h.success()}},0===a.length)return j();for(n=function(a){return a.validator(m(d),d,e,f,{success:function(){return j()},error:function(){if(a.enableError&&1===++i&&(g.$setValidity(f.ngModel,!1),a.error(m(d),d,e,f,c)),1===("function"==typeof h.error?h.error():void 0)){try{e[0].scrollIntoViewIfNeeded()}catch(b){}try{return e[0].select()}catch(b){}}}})},o=0,p=a.length;p>o;o++){switch(k=a[o],b){case"blur":if("blur"!==k.invoke)continue;k.enableError=!0;break;case"watch":if("watch"!==k.invoke&&!k.enableError){j();continue}break;case"broadcast":k.enableError=!0}n(k)}},o=function(){var a;return a=i.getRule("required"),null==a&&(a=i.convertRule("required",{validator:/^.+$/,invoke:"watch"})),q.push(a)},p=function(a){var b,g,h,i,j;for(j=[],b=g=0,h=q.length;h>g;b=g+=1)(null!=(i=q[b])?i.name:void 0)===a&&(q[b].success(m(d),d,e,f,c),q.splice(b,1),j.push(b--));return j},f.$observe("validator",function(a){var b,g,h,l,m,p,r,s,t,u,v,w,x,y;if(j.length=0,q.length=0,(n.validatorRequired||n.required)&&o(),l=a.match(/[^\[\s]+:[\s,]{0,1}\[[^\]]*\]/g))for(t=0,w=l.length;w>t;t++){if(g=l[t],b=[],h=g.split(":")[0].trim(),r=g.match(/\[(.+)\]/))for(s=r[1].split(","),u=0,x=s.length;x>u;u++)m=s[u],p=i.getRule(m.replace(/^\s+|\s+$/g,"")),"function"==typeof p.init&&p.init(d,e,f,c),p&&(b.push(p),q.push(p));j[h]=b,k.push(h)}else{if(l=a.match(/^\/(.*)\/$/))return p=i.convertRule("dynamic",{validator:RegExp(l[1]),invoke:f.validatorInvoke,error:f.validatorError}),void q.push(p);if(l=a.match(/^\[(.+)\]$/))for(s=l[1].split(","),v=0,y=s.length;y>v;v++)m=s[v],p=i.getRule(m.replace(/^\s+|\s+$/g,"")),"function"==typeof p.init&&p.init(d,e,f,c),p&&q.push(p)}}),f.$observe("validatorError",function(a){var b,c;return b=f.validator.match(/^\/(.*)\/$/),b?(p("dynamic"),c=i.convertRule("dynamic",{validator:RegExp(b[1]),invoke:f.validatorInvoke,error:a}),q.push(c)):void 0}),n={validatorRequired:!1,required:!1},f.$observe("validatorRequired",function(a){return a&&"false"!==a?(o(),n.validatorRequired=!0):n.validatorRequired?(p("required"),n.validatorRequired=!1):void 0}),f.$observe("required",function(a){return a&&"false"!==a?(o(),n.required=!0):n.required?(p("required"),n.required=!1):void 0}),l=function(a,c){var e,g,i,j;return c?b.call(k,c)>=0?!0:f.validatorGroup===c?!0:a.targetScope===d?0===f.ngModel.indexOf(c):(e=function(a,b){var c,d;for(c in a)switch(d=a[c],typeof d){case"string":if("$$hashKey"===c&&d===b)return!0;break;case"object":if(e(d,b))return!0}return!1},g=f.ngModel.indexOf("."),i=g>=0?f.ngModel.substr(0,g):f.ngModel,j=h(i)(d),e(h(c)(a.targetScope),j.$$hashKey)):!0},d.$on(i.broadcastChannel.prepare,function(a,b){return l(a,b.model)?b.accept():void 0}),d.$on(i.broadcastChannel.start,function(a,b){return l(a,b.model)?r("broadcast",{success:b.success,error:b.error,group:b.model}):void 0}),d.$on(i.broadcastChannel.reset,function(a,b){var h,i,j;if(l(a,b.model)){for(i=0,j=q.length;j>i;i++)h=q[i],h.success(m(d),d,e,f,c),"watch"!==h.invoke&&(h.enableError=!1);return g.$setValidity(f.ngModel,!0)}}),d.$watch(f.ngModel,function(a,b){return a!==b?r("watch",{oldValue:b}):void 0}),a(e).bind("blur",function(){return d.$root.$$phase?r("blur"):d.$apply(function(){return r("blur")})})}}}])}).call(this),function(){angular.module("validator",["validator.directive"])}.call(this),function(){var a;a=angular.element,angular.module("validator.provider",[]).provider("$validator",function(){var b,c,d;b=null,c=null,d=null,this.rules={},this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"},this.setupProviders=function(a){return b=a,c=b.get("$q"),d=b.get("$timeout")},this.convertError=function(b){return function(c,d,e,f){var g,h,i,j,k,l,m,n;for(h="function"==typeof b?b(c,d,e,f):b.constructor===String?b:"",j=a(e).parent(),n=[];0!==j.length;){if(j.hasClass("form-group")){for(j.addClass("has-error"),m=j.find("label"),k=0,l=m.length;l>k;k++)i=m[k],a(i).hasClass("error")&&a(i).remove();g=a("<label class='control-label error'>"+h+"</label>"),f.id&&g.attr("for",f.id),a(e).parent().hasClass("input-group")?a(e).parent().parent().append(g):a(e).parent().append(g);break}n.push(j=j.parent())}return n}},this.convertSuccess=function(b){return"function"==typeof b?b:function(b,c,d){var e,f,g,h,i,j;for(f=a(d).parent(),j=[];0!==f.length;){if(f.hasClass("has-error")){for(f.removeClass("has-error"),i=f.find("label"),g=0,h=i.length;h>g;g++)e=i[g],a(e).hasClass("error")&&a(e).remove();break}j.push(f=f.parent())}return j}},this.convertValidator=function(a){var d,e,f;return f=function(){},a.constructor===RegExp?(e=a,f=function(a,b,c,d,f){return null==a&&(a=""),e.test(a)?"function"==typeof f.success?f.success():void 0:"function"==typeof f.error?f.error():void 0}):"function"==typeof a&&(d=a,f=function(a,e,f,g,h){return c.all([d(a,e,f,g,b)]).then(function(a){return a&&a.length>0&&a[0]?"function"==typeof h.success?h.success():void 0:"function"==typeof h.error?h.error():void 0},function(){return"function"==typeof h.error?h.error():void 0})}),f},this.convertRule=function(a){return function(b,c){var d,e,f;return null==c&&(c={}),d={name:b,enableError:"watch"===c.invoke,invoke:c.invoke,init:c.init,validator:null!=(e=c.validator)?e:function(){return!0},error:null!=(f=c.error)?f:"",success:c.success},d.error=a.convertError(d.error),d.success=a.convertSuccess(d.success),d.validator=a.convertValidator(d.validator),d}}(this),this.register=function(a,b){return null==b&&(b={}),this.rules[a]=this.convertRule(a,b)},this.getRule=function(a){return this.rules[a]?angular.copy(this.rules[a]):null},this.validate=function(a){return function(e,f){var g,h,i,j,k;return i=c.defer(),k=i.promise,h={total:0,success:0,error:0},j={promises:{success:[],error:[],then:[]},accept:function(){return h.total++},validatedSuccess:function(){var a,b,c,d,e,f,g;if(++h.success===h.total){for(f=j.promises.success,b=0,d=f.length;d>b;b++)(a=f[b])();for(g=j.promises.then,c=0,e=g.length;e>c;c++)(a=g[c])()}return h.success},validatedError:function(){var a,b,c,d,e,f,g;if(0===h.error++){for(f=j.promises.error,b=0,d=f.length;d>b;b++)(a=f[b])();for(g=j.promises.then,c=0,e=g.length;e>c;c++)(a=g[c])()}return h.error}},k.success=function(a){return j.promises.success.push(a),k},k.error=function(a){return j.promises.error.push(a),k},k.then=function(a){return j.promises.then.push(a),k},g={model:f,accept:j.accept,success:j.validatedSuccess,error:j.validatedError},e.$broadcast(a.broadcastChannel.prepare,g),d(function(){var a,c,d,f,i;{if(0!==h.total)return a=b.get("$validator"),e.$broadcast(a.broadcastChannel.start,g);for(i=j.promises.success,d=0,f=i.length;f>d;d++)(c=i[d])()}}),k}}(this),this.reset=function(a){return function(b,c){return b.$broadcast(a.broadcastChannel.reset,{model:c})}}(this),this.get=function(a){return this.setupProviders(a),{rules:this.rules,broadcastChannel:this.broadcastChannel,register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}},this.get.$inject=["$injector"],this.$get=this.get})}.call(this);