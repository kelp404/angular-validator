(function(){var n;n=angular.element;angular.module("validator.directive",["validator.provider"]).directive("validator",["$injector",function(m){return{restrict:"A",require:"ngModel",link:function(e,q,b,k){var a,c,t,h,d,r,s,l,p;c=m.get("$validator");a=m.get("$parse");h=a(b.ngModel);l=[];p=function(f,g){var c,a,d,t,r,p,n;null==g&&(g={});c=t=0;a=function(){var f,c,a;if(++t>=l.length){k.$setValidity(b.ngModel,!0);c=0;for(a=l.length;c<a;c++)f=l[c],f.success(h(e),e,q,b,m);"function"===typeof g.success&&
g.success()}};if(0===l.length)return a();r=function(f){return f.validator(h(e),e,q,b,{success:function(){return a()},error:function(){f.enableError&&1===++c&&(k.$setValidity(b.ngModel,!1),f.error(h(e),e,q,b,m));if(1===("function"===typeof g.error?g.error():void 0)){try{q[0].scrollIntoViewIfNeeded()}catch(a){}return q[0].select()}}})};p=0;for(n=l.length;p<n;p++){d=l[p];switch(f){case "blur":if("blur"!==d.invoke)continue;d.enableError=!0;break;case "watch":if("watch"!==d.invoke&&!d.enableError){a();
continue}break;case "broadcast":d.enableError=!0}r(d)}};r=function(){var f;f=c.getRule("required");null==f&&(f=c.convertRule("required",{validator:/^.+$/,invoke:"watch"}));return l.push(f)};s=function(f){var g,c,a,d,k;k=[];g=c=0;for(a=l.length;c<a;g=c+=1)(null!=(d=l[g])?d.name:void 0)===f&&(l[g].success(h(e),e,q,b,m),l.splice(g,1),k.push(g--));return k};b.$observe("validator",function(f){var g,a,k,h;l.length=0;(d.validatorRequired||d.required)&&r();if(g=f.match(/^\/(.*)\/$/))a=c.convertRule("dynamic",
{validator:RegExp(g[1]),invoke:b.validatorInvoke,error:b.validatorError}),l.push(a);else if(g=f.match(/^\[(.+)\]$/)){f=g[1].split(",");h=[];g=0;for(k=f.length;g<k;g++)a=f[g],a=c.getRule(a.replace(/^\s+|\s+$/g,"")),"function"===typeof a.init&&a.init(e,q,b,m),a?h.push(l.push(a)):h.push(void 0);return h}});b.$observe("validatorError",function(f){var g;if(g=b.validator.match(/^\/(.*)\/$/))return s("dynamic"),f=c.convertRule("dynamic",{validator:RegExp(g[1]),invoke:b.validatorInvoke,error:f}),l.push(f)});
d={validatorRequired:!1,required:!1};b.$observe("validatorRequired",function(f){if(f&&"false"!==f)return r(),d.validatorRequired=!0;if(d.validatorRequired)return s("required"),d.validatorRequired=!1});b.$observe("required",function(f){if(f&&"false"!==f)return r(),d.required=!0;if(d.required)return s("required"),d.required=!1});t=function(f,g){var c,d;if(g){if(b.validatorGroup===g)return!0;if(f.targetScope===e)return 0===b.ngModel.indexOf(g);c=function(g,f){var a,b;for(a in g)switch(b=g[a],typeof b){case "string":if("$$hashKey"===
a&&b===f)return!0;break;case "object":if(c(b,f))return!0}return!1};d=b.ngModel.indexOf(".");d=0<=d?b.ngModel.substr(0,d):b.ngModel;d=a(d)(e);return c(a(g)(f.targetScope),d.$$hashKey)}return!0};e.$on(c.broadcastChannel.prepare,function(f,g){if(t(f,g.model))return g.accept()});e.$on(c.broadcastChannel.start,function(f,g){if(t(f,g.model))return p("broadcast",{success:g.success,error:g.error})});e.$on(c.broadcastChannel.reset,function(f,g){var c,a,d;if(t(f,g.model)){a=0;for(d=l.length;a<d;a++)c=l[a],
c.success(h(e),e,q,b,m),"watch"!==c.invoke&&(c.enableError=!1);return k.$setValidity(b.ngModel,!0)}});e.$watch(b.ngModel,function(c,a){if(c!==a)return p("watch",{oldValue:a})});return n(q).bind("blur",function(){return e.$root.$$phase?p("blur"):e.$apply(function(){return p("blur")})})}}}])}).call(this);(function(){angular.module("validator",["validator.directive"])}).call(this);
(function(){var n;n=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var m,e,q;q=e=m=null;this.rules={};this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"};this.setupProviders=function(b){m=b;e=m.get("$q");return q=m.get("$timeout")};this.convertError=function(b){var k;if("function"===typeof b)return b;k=b.constructor===String?b:"";return function(a,c,b,h){var d,e,m;c=n(b).parent();for(a=[];0!==c.length;){if(c.hasClass("form-group")){c.addClass("has-error");
m=c.find("label");d=0;for(e=m.length;d<e;d++)c=m[d],n(c).hasClass("error")&&n(c).remove();c=n("<label class='control-label error'>"+k+"</label>");h.id&&c.attr("for",h.id);n(b).parent().append(c);break}a.push(c=c.parent())}return a}};this.convertSuccess=function(b){return"function"===typeof b?b:function(b,a,c){var e,h;a=n(c).parent();for(b=[];0!==a.length;){if(a.hasClass("has-error")){a.removeClass("has-error");h=a.find("label");c=0;for(e=h.length;c<e;c++)a=h[c],n(a).hasClass("error")&&n(a).remove();
break}b.push(a=a.parent())}return b}};this.convertValidator=function(b){var k;k=function(){};b.constructor===RegExp?k=function(a,c,e,h,d){null==a&&(a="");return b.test(a)?"function"===typeof d.success?d.success():void 0:"function"===typeof d.error?d.error():void 0}:"function"===typeof b&&(k=function(a,c,k,h,d){return e.all([b(a,c,k,h,m)]).then(function(a){return a&&0<a.length&&a[0]?"function"===typeof d.success?d.success():void 0:"function"===typeof d.error?d.error():void 0},function(){return"function"===
typeof d.error?d.error():void 0})});return k};this.convertRule=function(b){return function(e,a){var c,m,h;null==a&&(a={});c={name:e,enableError:"watch"===a.invoke,invoke:a.invoke,init:a.init,validator:null!=(m=a.validator)?m:function(){return!0},error:null!=(h=a.error)?h:"",success:a.success};c.error=b.convertError(c.error);c.success=b.convertSuccess(c.success);c.validator=b.convertValidator(c.validator);return c}}(this);this.register=function(b,e){null==e&&(e={});return this.rules[b]=this.convertRule(b,
e)};this.getRule=function(b){return this.rules[b]?angular.copy(this.rules[b]):null};this.validate=function(b){return function(k,a){var c,n,h,d,r,s,l,p;p=e.defer().promise;s=r=d=0;c=[];n=[];h=[];p.success=function(a){c.push(a);return p};p.error=function(a){n.push(a);return p};p.then=function(a){h.push(a);return p};l={model:a,accept:function(){return d++},success:function(){var a,b,e;if(++r===d){b=0;for(e=c.length;b<e;b++)a=c[b],a();b=0;for(e=h.length;b<e;b++)a=h[b],a()}return r},error:function(){var a,
b,c;if(0===s++){b=0;for(c=n.length;b<c;b++)a=n[b],a();b=0;for(c=h.length;b<c;b++)a=h[b],a()}return s}};k.$broadcast(b.broadcastChannel.prepare,l);q(function(){var a,b,e;if(0===d)for(b=0,e=c.length;b<e;b++)a=c[b],a();else return a=m.get("$validator"),k.$broadcast(a.broadcastChannel.start,l)});return p}}(this);this.reset=function(b){return function(e,a){return e.$broadcast(b.broadcastChannel.reset,{model:a})}}(this);this.get=function(b){this.setupProviders(b);return{rules:this.rules,broadcastChannel:this.broadcastChannel,
register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}};this.get.$inject=["$injector"];this.$get=this.get})}).call(this);
