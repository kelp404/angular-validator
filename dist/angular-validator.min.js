(function(){var m;m=angular.element;angular.module("validator.directive",["validator.provider"]).directive("validator",["$injector",function(p){return{restrict:"A",require:"ngModel",link:function(h,r,c){var d,b,a,q,e,g,l,k,s;b=p.get("$validator");d=p.get("$parse");q=d(c.ngModel);k=[];s=function(n,f){var b,a,d,e,g,l;null==f&&(f={});d=0;b=function(){var a,n,b;if(++d===k.length){n=0;for(b=k.length;n<b;n++)a=k[n],a.success(q(h),h,r,c,p);"function"===typeof f.success&&f.success()}};l=[];e=0;for(g=k.length;e<
g;e++){a=k[e];switch(n){case "blur":if("blur"!==a.invoke)continue;a.enableError=!0;break;case "watch":if("watch"!==a.invoke&&!a.enableError){b();continue}break;case "broadcast":a.enableError=!0}l.push(function(n){return n.validator(q(h),h,r,c,{success:function(){return b()},error:function(){n.enableError&&n.error(q(h),h,r,c,p);if(1===("function"===typeof f.error?f.error():void 0)){try{r[0].scrollIntoViewIfNeeded()}catch(a){}return r[0].select()}}})}(a))}return l};g=function(){var n;n=b.getRule("required");
null==n&&(n=b.convertRule("required",{validator:/^.+$/,invoke:"watch"}));return k.push(n)};l=function(n){var f,a,b,e,d;d=[];f=a=0;for(b=k.length;a<b;f=a+=1)(null!=(e=k[f])?e.name:void 0)===n&&(k[f].success(q(h),h,r,c,p),k.splice(f,1),d.push(f--));return d};c.$observe("validator",function(a){var f,d,q,l;k.length=0;(e.validatorRequired||e.required)&&g();if(f=a.match(/^\/(.*)\/$/))d=b.convertRule("dynamic",{validator:RegExp(f[1]),invoke:c.validatorInvoke,error:c.validatorError}),k.push(d);else if(f=
a.match(/^\[(.*)\]$/)){a=f[1].split(",");l=[];f=0;for(q=a.length;f<q;f++)d=a[f],d=b.getRule(d.replace(/^\s+|\s+$/g,"")),"function"===typeof d.init&&d.init(h,r,c,p),d?l.push(k.push(d)):l.push(void 0);return l}});c.$observe("validatorError",function(a){var f;if(f=c.validator.match(/^\/(.*)\/$/))return l("dynamic"),a=b.convertRule("dynamic",{validator:RegExp(f[1]),invoke:c.validatorInvoke,error:a}),k.push(a)});e={validatorRequired:!1,required:!1};c.$observe("validatorRequired",function(a){if(a&&"false"!==
a)return g(),e.validatorRequired=!0;if(e.validatorRequired)return l("required"),e.validatorRequired=!1});c.$observe("required",function(a){if(a&&"false"!==a)return g(),e.required=!0;if(e.required)return l("required"),e.required=!1});a=function(a,f){var b,e;if(f){if(c.validatorGroup===f)return!0;if(a.targetScope===h)return 0===c.ngModel.indexOf(f);b=function(a,f){var c,d;for(c in a)switch(d=a[c],typeof d){case "string":if("$$hashKey"===c&&d===f)return!0;break;case "object":if(b(d,f))return!0}return!1};
e=c.ngModel.indexOf(".");e=0<=e?c.ngModel.substr(0,e):c.ngModel;e=d(e)(h);return b(d(f)(a.targetScope),e.$$hashKey)}return!0};h.$on(b.broadcastChannel.prepare,function(b,f){if(a(b,f.model))return f.accept()});h.$on(b.broadcastChannel.start,function(b,f){if(a(b,f.model))return s("broadcast",{success:f.success,error:f.error})});h.$on(b.broadcastChannel.reset,function(b,f){var d,e,g;if(a(b,f.model))for(e=0,g=k.length;e<g;e++)d=k[e],d.success(q(h),h,r,c,p),"watch"!==d.invoke&&(d.enableError=!1)});h.$watch(c.ngModel,
function(a,b){if(a!==b)return s("watch",{oldValue:b})});return m(r).bind("blur",function(){return h.$apply(function(){return s("blur")})})}}}])}).call(this);(function(){angular.module("validator",["validator.directive"])}).call(this);
(function(){var m;m=angular.element;angular.module("validator.provider",[]).provider("$validator",function(){var p,h,r;r=h=p=null;this.rules={};this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"};this.setupProviders=function(c){p=c;h=p.get("$q");return r=p.get("$timeout")};this.convertError=function(c){var d;if("function"===typeof c)return c;d=c.constructor===String?c:"";return function(b,a,c,e){var g,l,k;a=m(c).parent();for(b=[];0!==a.length;){if(a.hasClass("form-group")){a.addClass("has-error");
k=a.find("label");g=0;for(l=k.length;g<l;g++)a=k[g],m(a).hasClass("error")&&m(a).remove();a=m("<label class='control-label error'>"+d+"</label>");e.id&&a.attr("for",e.id);m(c).parent().append(a);break}b.push(a=a.parent())}return b}};this.convertSuccess=function(c){return"function"===typeof c?c:function(c,b,a){var h,e;b=m(a).parent();for(c=[];0!==b.length;){if(b.hasClass("has-error")){b.removeClass("has-error");e=b.find("label");a=0;for(h=e.length;a<h;a++)b=e[a],m(b).hasClass("error")&&m(b).remove();
break}c.push(b=b.parent())}return c}};this.convertValidator=function(c){var d;d=function(){};c.constructor===RegExp?d=function(b,a,d,e,g){null==b&&(b="");return c.test(b)?"function"===typeof g.success?g.success():void 0:"function"===typeof g.error?g.error():void 0}:"function"===typeof c&&(d=function(b,a,d,e,g){return h.all([c(b,a,d,e,p)]).then(function(a){return a&&0<a.length&&a[0]?"function"===typeof g.success?g.success():void 0:"function"===typeof g.error?g.error():void 0},function(){return"function"===
typeof g.error?g.error():void 0})});return d};this.convertRule=function(c){return function(d,b){var a,h,e;null==b&&(b={});a={name:d,enableError:"watch"===b.invoke,invoke:b.invoke,init:b.init,validator:null!=(h=b.validator)?h:function(){return!0},error:null!=(e=b.error)?e:"",success:b.success};a.error=c.convertError(a.error);a.success=c.convertSuccess(a.success);a.validator=c.convertValidator(a.validator);return a}}(this);this.register=function(c,d){null==d&&(d={});return this.rules[c]=this.convertRule(c,
d)};this.getRule=function(c){return this.rules[c]?this.rules[c]:null};this.validate=function(c){return function(d,b){var a,q,e,g,l,k,m;m=h.defer().promise;l=g=e=0;a=[];q=[];m.success=function(b){a.push(b);return m};m.error=function(a){q.push(a);return m};k={model:b,accept:function(){return e++},success:function(){var b,c,d;if(++g===e)for(c=0,d=a.length;c<d;c++)b=a[c],b();return g},error:function(){var a,b,c;if(0===l++)for(b=0,c=q.length;b<c;b++)a=q[b],a();return l}};d.$broadcast(c.broadcastChannel.prepare,
k);r(function(){var b,c,g;if(0===e)for(c=0,g=a.length;c<g;c++)b=a[c],b();else return b=p.get("$validator"),d.$broadcast(b.broadcastChannel.start,k)});return m}}(this);this.reset=function(c){return function(d,b){return d.$broadcast(c.broadcastChannel.reset,{model:b})}}(this);this.get=function(c){this.setupProviders(c);return{rules:this.rules,broadcastChannel:this.broadcastChannel,register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}};this.get.$inject=
["$injector"];this.$get=this.get})}).call(this);
